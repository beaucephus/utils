#!/usr/bin/env ruby
# vim: set syntax=ruby

flag = false

staged_files = `git diff --cached --name-only`.split

ruby_files = staged_files.select{|s| s =~ /\.rb$/}

ruby_files.each do |file|
  puts "Checking #{file}"
  result = `ruby -c #{file}`
  flag = true if $?.exitstatus > 0
end

abort("Failed syntax check. Fix and recommit.") if flag

puts "All staged files passed syntax check. Continuing commit..."
